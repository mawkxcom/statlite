{"version":3,"sources":["../src/index.ts"],"sourcesContent":["type StatliteOptions = {\n  endpoint?: string; // e.g. https://api.example.com or https://host/statlite\n  site?: string; // default: script host domain\n};\n\nfunction inferPagePath(): string {\n  if (typeof window === 'undefined') return '/';\n  return window.location.pathname + window.location.search;\n}\n\nasync function postJSON(url: string, data: any) {\n  await fetch(url, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify(data),\n    credentials: 'omit'\n  });\n}\n\nexport function track(options: StatliteOptions) {\n  const defaults = getDefaults();\n  const endpoint = (options.endpoint || defaults.endpoint).replace(/\\/$/, '');\n  const site = options.site || defaults.site;\n  const page = inferPagePath();\n  const title = typeof document !== 'undefined' ? document.title : undefined;\n\n  const url = `${endpoint}/stats/track`;\n  postJSON(url, { site, page, title }).catch(() => void 0);\n}\n\nexport function mount(dom?: Document) {\n  const d = dom || document;\n  const elements = Array.from(d.querySelectorAll('[data-statlite]')) as HTMLElement[];\n  elements.forEach(async (el) => {\n    const metric = el.dataset.statlite; // pv | uv | pagepv\n    const defaults = getDefaults();\n    const site = el.dataset.site || defaults.site;\n    const endpoint = (el.dataset.endpoint || defaults.endpoint).replace(/\\/$/, '');\n    const page = el.dataset.page || inferPagePath();\n    if (!site || !metric) return;\n\n    try {\n      const qs = new URLSearchParams({ site, page });\n      const resp = await fetch(`${endpoint}/stats/summary?${qs.toString()}`);\n      const data = await resp.json();\n      let text = '';\n      if (metric === 'pv') text = String(data.totalPv ?? '0');\n      if (metric === 'uv') text = String(data.totalUv ?? '0');\n      if (metric === 'pagepv') text = String(data.pagePv ?? '0');\n      el.textContent = text;\n    } catch {\n      // ignore\n    }\n  });\n}\n\n// auto bootstrap\nif (typeof window !== 'undefined') {\n  const SCRIPT_INFO = (() => {\n    try {\n      const s = (document.currentScript as HTMLScriptElement | null);\n      if (s?.src) {\n        const u = new URL(s.src, window.location.href);\n        return { origin: u.origin, hostname: u.hostname };\n      }\n    } catch {}\n    return { origin: window.location.origin, hostname: window.location.hostname };\n  })();\n\n  function getDefaults() {\n    return {\n      site: SCRIPT_INFO.hostname,\n      endpoint: SCRIPT_INFO.origin.replace(/\\/$/, '') + '/statlite',\n    };\n  }\n\n  // auto-track after DOMContentLoaded\n  window.addEventListener('DOMContentLoaded', () => {\n    const defaults = getDefaults();\n    const site = document.querySelector('[data-statlite-site]')?.getAttribute('data-statlite-site') || undefined;\n    const endpoint = document.querySelector('[data-statlite-endpoint]')?.getAttribute('data-statlite-endpoint') || undefined;\n    track({ site: site || defaults.site, endpoint: endpoint || defaults.endpoint });\n    mount();\n  });\n}\n\n// for non-window environments\nfunction getDefaults() {\n  return { site: 'localhost', endpoint: '' };\n}\n\n\n"],"mappings":"4bAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,WAAAE,EAAA,UAAAC,IAKA,SAASC,GAAwB,CAC/B,OAAI,OAAO,OAAW,IAAoB,IACnC,OAAO,SAAS,SAAW,OAAO,SAAS,MACpD,CAEA,eAAeC,EAASC,EAAaC,EAAW,CAC9C,MAAM,MAAMD,EAAK,CACf,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAmB,EAC9C,KAAM,KAAK,UAAUC,CAAI,EACzB,YAAa,MACf,CAAC,CACH,CAEO,SAASJ,EAAMK,EAA0B,CAC9C,IAAMC,EAAWC,EAAY,EACvBC,GAAYH,EAAQ,UAAYC,EAAS,UAAU,QAAQ,MAAO,EAAE,EACpEG,EAAOJ,EAAQ,MAAQC,EAAS,KAChCI,EAAOT,EAAc,EACrBU,EAAQ,OAAO,SAAa,IAAc,SAAS,MAAQ,OAE3DR,EAAM,GAAGK,CAAQ,eACvBN,EAASC,EAAK,CAAE,KAAAM,EAAM,KAAAC,EAAM,MAAAC,CAAM,CAAC,EAAE,MAAM,IAAG,EAAS,CACzD,CAEO,SAASZ,EAAMa,EAAgB,CACpC,IAAMC,EAAID,GAAO,SACA,MAAM,KAAKC,EAAE,iBAAiB,iBAAiB,CAAC,EACxD,QAAQ,MAAOC,GAAO,CAC7B,IAAMC,EAASD,EAAG,QAAQ,SACpBR,EAAWC,EAAY,EACvBE,EAAOK,EAAG,QAAQ,MAAQR,EAAS,KACnCE,GAAYM,EAAG,QAAQ,UAAYR,EAAS,UAAU,QAAQ,MAAO,EAAE,EACvEI,EAAOI,EAAG,QAAQ,MAAQb,EAAc,EAC9C,GAAI,GAACQ,GAAQ,CAACM,GAEd,GAAI,CACF,IAAMC,EAAK,IAAI,gBAAgB,CAAE,KAAAP,EAAM,KAAAC,CAAK,CAAC,EAEvCN,EAAO,MADA,MAAM,MAAM,GAAGI,CAAQ,kBAAkBQ,EAAG,SAAS,CAAC,EAAE,GAC7C,KAAK,EACzBC,EAAO,GACPF,IAAW,OAAME,EAAO,OAAOb,EAAK,SAAW,GAAG,GAClDW,IAAW,OAAME,EAAO,OAAOb,EAAK,SAAW,GAAG,GAClDW,IAAW,WAAUE,EAAO,OAAOb,EAAK,QAAU,GAAG,GACzDU,EAAG,YAAcG,CACnB,MAAQ,CAER,CACF,CAAC,CACH,CAGA,GAAI,OAAO,OAAW,IAAa,CAYjC,IAASV,EAAT,UAAuB,CACrB,MAAO,CACL,KAAMW,EAAY,SAClB,SAAUA,EAAY,OAAO,QAAQ,MAAO,EAAE,EAAI,WACpD,CACF,EALSX,IAXT,IAAMW,GAAe,IAAM,CACzB,GAAI,CACF,IAAMC,EAAK,SAAS,cACpB,GAAIA,GAAG,IAAK,CACV,IAAMC,EAAI,IAAI,IAAID,EAAE,IAAK,OAAO,SAAS,IAAI,EAC7C,MAAO,CAAE,OAAQC,EAAE,OAAQ,SAAUA,EAAE,QAAS,CAClD,CACF,MAAQ,CAAC,CACT,MAAO,CAAE,OAAQ,OAAO,SAAS,OAAQ,SAAU,OAAO,SAAS,QAAS,CAC9E,GAAG,EAUH,OAAO,iBAAiB,mBAAoB,IAAM,CAChD,IAAMd,EAAWC,EAAY,EACvBE,EAAO,SAAS,cAAc,sBAAsB,GAAG,aAAa,oBAAoB,GAAK,OAC7FD,EAAW,SAAS,cAAc,0BAA0B,GAAG,aAAa,wBAAwB,GAAK,OAC/GR,EAAM,CAAE,KAAMS,GAAQH,EAAS,KAAM,SAAUE,GAAYF,EAAS,QAAS,CAAC,EAC9EP,EAAM,CACR,CAAC,CACH,CAfW,IAAAQ,EAkBX,SAASA,GAAc,CACrB,MAAO,CAAE,KAAM,YAAa,SAAU,EAAG,CAC3C","names":["index_exports","__export","mount","track","inferPagePath","postJSON","url","data","options","defaults","getDefaults","endpoint","site","page","title","dom","d","el","metric","qs","text","SCRIPT_INFO","s","u"]}